---
phase: 04-realtime-compliance
plan: 01
type: execute
wave: 1
wave_type: ASYNC
depends_on: []
files_modified:
  - server/app/services/websocket.py
  - server/app/routers/ws.py
autonomous: true
difficulty: medium
---

<objective>
Implement WebSocket server for real-time events using Socket.IO pattern over FastAPI WebSockets.

Purpose: Stream ingestion progress, skill execution status, and system notifications to connected clients in real-time.
</objective>

<tasks>
<task type="auto">
  <name>Create WebSocket server and event router</name>
  <files>
    server/app/services/websocket.py
    server/app/routers/ws.py
  </files>
  <action>
    WebSocket service:
    - ConnectionManager: track active connections per room (org_id, project_id)
    - JWT auth on connection (validate Bearer token from query param)
    - Rooms: org:{org_id}, project:{project_id}, user:{user_id}
    - Events: ingestion_progress, execution_update, notification
    - Broadcast to room, send to specific connection
    - Heartbeat/ping-pong for connection health

    WebSocket router:
    - WS /ws â€” main WebSocket endpoint with JWT auth
    - Event publishing utility for use by other services
  </action>
</task>
</tasks>
